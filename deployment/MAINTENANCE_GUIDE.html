<!DOCTYPE html>
<html>
<head>
<title>MAINTENANCE_GUIDE.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="rag-interface-system---maintenance-and-operations-guide">RAG Interface System - Maintenance and Operations Guide</h1>
<h2 id="%F0%9F%93%8B-table-of-contents">ðŸ“‹ Table of Contents</h2>
<ol>
<li><a href="#maintenance-schedule">Maintenance Schedule</a></li>
<li><a href="#backup-procedures">Backup Procedures</a></li>
<li><a href="#update-processes">Update Processes</a></li>
<li><a href="#monitoring-guidelines">Monitoring Guidelines</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#security-maintenance">Security Maintenance</a></li>
<li><a href="#disaster-recovery">Disaster Recovery</a></li>
<li><a href="#capacity-planning">Capacity Planning</a></li>
</ol>
<h2 id="%F0%9F%93%85-maintenance-schedule">ðŸ“… Maintenance Schedule</h2>
<h3 id="daily-tasks-automated">Daily Tasks (Automated)</h3>
<h4 id="system-health-monitoring">System Health Monitoring</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># daily_health_check.sh - Run via cron daily</span>

LOG_FILE=<span class="hljs-string">"/var/log/rag-interface/daily_health_<span class="hljs-variable">$(date +%Y%m%d)</span>.log"</span>
mkdir -p /var/<span class="hljs-built_in">log</span>/rag-interface

{
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Daily Health Check - <span class="hljs-variable">$(date)</span> ==="</span>
    
    <span class="hljs-comment"># Service status</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Service Status:"</span>
    <span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman
    podman-compose ps
    
    <span class="hljs-comment"># Resource usage</span>
    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nResource Usage:"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Memory: <span class="hljs-variable">$(free -h | grep Mem | awk '{print $3 "/" $2}')</span>"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Disk: <span class="hljs-variable">$(df -h / | tail -1 | awk '{print $3 "/" $2 " (" $5 " used)</span>"</span>}<span class="hljs-string">')"
    echo "Load: $(uptime | awk -F'</span>load average:<span class="hljs-string">' '</span>{<span class="hljs-built_in">print</span> <span class="hljs-variable">$2</span>}<span class="hljs-string">')"
    
    # Error count
    echo -e "\nError Summary (last 24h):"
    podman-compose logs --since=24h | grep -i error | wc -l
    
    # Database connections
    echo -e "\nDatabase Connections:"
    podman-compose exec postgres psql -U postgres -c "SELECT count(*) as active_connections FROM pg_stat_activity WHERE state = '</span>active<span class="hljs-string">';" -t
    
} &gt;&gt; "$LOG_FILE"

# Alert if critical issues found
if podman-compose ps | grep -q "Exit\|Restarting"; then
    echo "ALERT: Service issues detected" | mail -s "RAG Interface Alert" admin@company.com
fi
</span></div></code></pre>
<h4 id="log-rotation">Log Rotation</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Setup logrotate for application logs</span>
cat &gt; /etc/logrotate.d/rag-interface &lt;&lt; EOF
/var/<span class="hljs-built_in">log</span>/rag-interface/*.<span class="hljs-built_in">log</span> {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}
EOF
</div></code></pre>
<h3 id="weekly-tasks">Weekly Tasks</h3>
<h4 id="database-maintenance">Database Maintenance</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># weekly_db_maintenance.sh</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Weekly Database Maintenance - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-comment"># Vacuum and analyze all databases</span>
databases=(<span class="hljs-string">"error_reporting_db"</span> <span class="hljs-string">"user_management_db"</span> <span class="hljs-string">"verification_db"</span> <span class="hljs-string">"correction_engine_db"</span> <span class="hljs-string">"rag_integration_db"</span>)

<span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${databases[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Maintaining database: <span class="hljs-variable">$db</span>"</span>
    podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d <span class="hljs-string">"<span class="hljs-variable">$db</span>"</span> -c <span class="hljs-string">"VACUUM ANALYZE;"</span>
    
    <span class="hljs-comment"># Check database size</span>
    size=$(podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d <span class="hljs-string">"<span class="hljs-variable">$db</span>"</span> -c <span class="hljs-string">"SELECT pg_size_pretty(pg_database_size('<span class="hljs-variable">$db</span>'));"</span> -t)
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Database <span class="hljs-variable">$db</span> size: <span class="hljs-variable">$size</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># Clean old audit logs (older than 90 days)</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d error_reporting_db -c <span class="hljs-string">"
DELETE FROM error_audit_logs WHERE performed_at &lt; NOW() - INTERVAL '90 days';
"</span>

podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
DELETE FROM user_audit_logs WHERE created_at &lt; NOW() - INTERVAL '90 days';
"</span>

<span class="hljs-comment"># Update database statistics</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -c <span class="hljs-string">"SELECT pg_stat_reset();"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Database maintenance completed"</span>
</div></code></pre>
<h4 id="cache-cleanup">Cache Cleanup</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># weekly_cache_cleanup.sh</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Weekly Cache Cleanup - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-comment"># Clean expired cache entries</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d verification_db -c <span class="hljs-string">"SELECT cleanup_expired_cache();"</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d rag_integration_db -c <span class="hljs-string">"SELECT cleanup_expired_cache();"</span>

<span class="hljs-comment"># Redis memory optimization</span>
podman-compose <span class="hljs-built_in">exec</span> redis redis-cli MEMORY PURGE

<span class="hljs-comment"># Check Redis memory usage</span>
memory_used=$(podman-compose <span class="hljs-built_in">exec</span> redis redis-cli info memory | grep used_memory_human | cut -d: -f2)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Redis memory usage: <span class="hljs-variable">$memory_used</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Cache cleanup completed"</span>
</div></code></pre>
<h3 id="monthly-tasks">Monthly Tasks</h3>
<h4 id="system-updates">System Updates</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monthly_system_update.sh</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Monthly System Update - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-comment"># Update system packages</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v apt &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    sudo apt update &amp;&amp; sudo apt upgrade -y
<span class="hljs-keyword">elif</span> <span class="hljs-built_in">command</span> -v dnf &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    sudo dnf update -y
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Update container images</span>
<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman
podman-compose pull

<span class="hljs-comment"># Restart services with new images</span>
podman-compose up -d

<span class="hljs-comment"># Wait for services to be ready</span>
sleep 60

<span class="hljs-comment"># Verify all services are healthy</span>
./health_check.sh

<span class="hljs-built_in">echo</span> <span class="hljs-string">"System update completed"</span>
</div></code></pre>
<h4 id="security-audit">Security Audit</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monthly_security_audit.sh</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Monthly Security Audit - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-comment"># Check for failed login attempts</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed login attempts (last 30 days):"</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
SELECT COUNT(*) as failed_attempts 
FROM user_audit_logs 
WHERE action = 'login_failed' 
AND created_at &gt; NOW() - INTERVAL '30 days';
"</span>

<span class="hljs-comment"># Check user account status</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"User account summary:"</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
SELECT status, COUNT(*) as count 
FROM users 
GROUP BY status;
"</span>

<span class="hljs-comment"># Check for inactive users</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Inactive users (no login in 30 days):"</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
SELECT username, last_login_at 
FROM users 
WHERE last_login_at &lt; NOW() - INTERVAL '30 days' 
OR last_login_at IS NULL;
"</span>

<span class="hljs-comment"># Check container vulnerabilities (if available)</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v podman &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Scanning container images for vulnerabilities..."</span>
    podman-compose images --format <span class="hljs-string">"{{.Repository}}:{{.Tag}}"</span> | xargs -I {} podman image scan {} || <span class="hljs-built_in">echo</span> <span class="hljs-string">"Vulnerability scanning not available"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Security audit completed"</span>
</div></code></pre>
<h2 id="%F0%9F%92%BE-backup-procedures">ðŸ’¾ Backup Procedures</h2>
<h3 id="automated-daily-backups">Automated Daily Backups</h3>
<h4 id="database-backup-script">Database Backup Script</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># daily_backup.sh</span>

BACKUP_DIR=<span class="hljs-string">"/opt/backups/rag-interface"</span>
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

mkdir -p <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>"</span>
<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Daily Backup - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-comment"># Database backups</span>
databases=(<span class="hljs-string">"error_reporting_db"</span> <span class="hljs-string">"user_management_db"</span> <span class="hljs-string">"verification_db"</span> <span class="hljs-string">"correction_engine_db"</span> <span class="hljs-string">"rag_integration_db"</span>)

<span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${databases[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Backing up database: <span class="hljs-variable">$db</span>"</span>
    podman-compose <span class="hljs-built_in">exec</span> postgres pg_dump -U postgres -Fc <span class="hljs-string">"<span class="hljs-variable">$db</span>"</span> &gt; <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>/<span class="hljs-variable">${db}</span>.dump"</span>
    
    <span class="hljs-comment"># Verify backup</span>
    <span class="hljs-keyword">if</span> [ -s <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>/<span class="hljs-variable">${db}</span>.dump"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ“ <span class="hljs-variable">$db</span> backup successful"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ— <span class="hljs-variable">$db</span> backup failed"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># Configuration backup</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Backing up configuration..."</span>
cp .env <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>/env_backup"</span>
cp docker-compose.yml <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>/compose_backup.yml"</span>

<span class="hljs-comment"># Redis backup</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Backing up Redis..."</span>
podman-compose <span class="hljs-built_in">exec</span> redis redis-cli BGSAVE
sleep 10
podman cp $(podman-compose ps -q redis):/data/dump.rdb <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>/redis_dump.rdb"</span>

<span class="hljs-comment"># Compress backup</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Compressing backup..."</span>
tar -czf <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/rag_interface_backup_<span class="hljs-variable">$DATE</span>.tar.gz"</span> -C <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$DATE</span>"</span>
rm -rf <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/<span class="hljs-variable">$DATE</span>"</span>

<span class="hljs-comment"># Clean old backups</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Cleaning old backups..."</span>
find <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>"</span> -name <span class="hljs-string">"rag_interface_backup_*.tar.gz"</span> -mtime +<span class="hljs-variable">$RETENTION_DAYS</span> -delete

<span class="hljs-comment"># Verify backup integrity</span>
<span class="hljs-keyword">if</span> tar -tzf <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>/rag_interface_backup_<span class="hljs-variable">$DATE</span>.tar.gz"</span> &gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ“ Backup integrity verified"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Backup completed: <span class="hljs-variable">$BACKUP_DIR</span>/rag_interface_backup_<span class="hljs-variable">$DATE</span>.tar.gz"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ— Backup integrity check failed"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</div></code></pre>
<h4 id="backup-restoration">Backup Restoration</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># restore_backup.sh</span>

<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -ne 1 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> &lt;backup_file&gt;"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Example: <span class="hljs-variable">$0</span> /opt/backups/rag-interface/rag_interface_backup_20250120_120000.tar.gz"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

BACKUP_FILE=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
RESTORE_DIR=<span class="hljs-string">"/tmp/rag_restore_<span class="hljs-variable">$(date +%s)</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Backup Restoration - <span class="hljs-variable">$(date)</span> ==="</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Restoring from: <span class="hljs-variable">$BACKUP_FILE</span>"</span>

<span class="hljs-comment"># Extract backup</span>
mkdir -p <span class="hljs-string">"<span class="hljs-variable">$RESTORE_DIR</span>"</span>
tar -xzf <span class="hljs-string">"<span class="hljs-variable">$BACKUP_FILE</span>"</span> -C <span class="hljs-string">"<span class="hljs-variable">$RESTORE_DIR</span>"</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-comment"># Stop services</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Stopping services..."</span>
podman-compose down

<span class="hljs-comment"># Start only database</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting database..."</span>
podman-compose up -d postgres redis
sleep 30

<span class="hljs-comment"># Restore databases</span>
databases=(<span class="hljs-string">"error_reporting_db"</span> <span class="hljs-string">"user_management_db"</span> <span class="hljs-string">"verification_db"</span> <span class="hljs-string">"correction_engine_db"</span> <span class="hljs-string">"rag_integration_db"</span>)

<span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${databases[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Restoring database: <span class="hljs-variable">$db</span>"</span>
    
    <span class="hljs-comment"># Drop and recreate database</span>
    podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -c <span class="hljs-string">"DROP DATABASE IF EXISTS <span class="hljs-variable">$db</span>;"</span>
    podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -c <span class="hljs-string">"CREATE DATABASE <span class="hljs-variable">$db</span>;"</span>
    
    <span class="hljs-comment"># Restore from backup</span>
    cat <span class="hljs-string">"<span class="hljs-variable">$RESTORE_DIR</span>"</span>/*/<span class="hljs-string">"<span class="hljs-variable">${db}</span>.dump"</span> | podman-compose <span class="hljs-built_in">exec</span> -T postgres pg_restore -U postgres -d <span class="hljs-string">"<span class="hljs-variable">$db</span>"</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ“ <span class="hljs-variable">$db</span> restored"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># Restore Redis</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Restoring Redis..."</span>
podman cp <span class="hljs-string">"<span class="hljs-variable">$RESTORE_DIR</span>"</span>/*/redis_dump.rdb $(podman-compose ps -q redis):/data/dump.rdb
podman-compose restart redis

<span class="hljs-comment"># Restore configuration (manual review recommended)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Configuration files available in: <span class="hljs-variable">$RESTORE_DIR</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Please review and manually restore configuration if needed"</span>

<span class="hljs-comment"># Start all services</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting all services..."</span>
podman-compose up -d

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Restoration completed"</span>
</div></code></pre>
<h2 id="%F0%9F%94%84-update-processes">ðŸ”„ Update Processes</h2>
<h3 id="application-updates">Application Updates</h3>
<h4 id="rolling-update-procedure">Rolling Update Procedure</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># rolling_update.sh</span>

VERSION=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$VERSION</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> &lt;version&gt;"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Rolling Update to Version <span class="hljs-variable">$VERSION</span> ==="</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-comment"># Create backup before update</span>
./daily_backup.sh

<span class="hljs-comment"># Update git repository</span>
git fetch origin
git checkout <span class="hljs-string">"v<span class="hljs-variable">$VERSION</span>"</span>

<span class="hljs-comment"># Update environment if needed</span>
<span class="hljs-keyword">if</span> [ -f <span class="hljs-string">".env.v<span class="hljs-variable">$VERSION</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Updating environment configuration..."</span>
    cp <span class="hljs-string">".env.v<span class="hljs-variable">$VERSION</span>"</span> .env
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Build new images</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Building new images..."</span>
podman-compose build

<span class="hljs-comment"># Update services one by one</span>
services=(<span class="hljs-string">"error-reporting-service"</span> <span class="hljs-string">"user-management-service"</span> <span class="hljs-string">"rag-integration-service"</span> <span class="hljs-string">"correction-engine-service"</span> <span class="hljs-string">"verification-service"</span> <span class="hljs-string">"frontend"</span>)

<span class="hljs-keyword">for</span> service <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${services[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Updating <span class="hljs-variable">$service</span>..."</span>
    
    <span class="hljs-comment"># Update service</span>
    podman-compose up -d --no-deps <span class="hljs-string">"<span class="hljs-variable">$service</span>"</span>
    
    <span class="hljs-comment"># Wait for health check</span>
    sleep 30
    
    <span class="hljs-comment"># Verify service is healthy</span>
    <span class="hljs-keyword">if</span> ! curl -f <span class="hljs-string">"http://localhost:<span class="hljs-variable">$(podman-compose port $service | cut -d: -f2)</span>/health"</span> &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ— <span class="hljs-variable">$service</span> health check failed"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Rolling back..."</span>
        git checkout -
        podman-compose up -d --no-deps <span class="hljs-string">"<span class="hljs-variable">$service</span>"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ“ <span class="hljs-variable">$service</span> updated successfully"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Rolling update completed successfully"</span>
</div></code></pre>
<h3 id="database-schema-updates">Database Schema Updates</h3>
<h4 id="schema-migration-script">Schema Migration Script</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># migrate_schema.sh</span>

MIGRATION_DIR=<span class="hljs-string">"/opt/rag-interface/deployment/database/migrations"</span>
VERSION=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$VERSION</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> &lt;version&gt;"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Database Schema Migration to Version <span class="hljs-variable">$VERSION</span> ==="</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-comment"># Create backup before migration</span>
./daily_backup.sh

<span class="hljs-comment"># Run migration scripts</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$MIGRATION_DIR</span>/v<span class="hljs-variable">$VERSION</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">for</span> script <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$MIGRATION_DIR</span>/v<span class="hljs-variable">$VERSION</span>"</span>/*.sql; <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$script</span>"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Running migration: <span class="hljs-variable">$(basename $script)</span>"</span>
            podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -f <span class="hljs-string">"/migrations/v<span class="hljs-variable">$VERSION</span>/<span class="hljs-variable">$(basename $script)</span>"</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"No migration scripts found for version <span class="hljs-variable">$VERSION</span>"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Schema migration completed"</span>
</div></code></pre>
<h2 id="%F0%9F%93%8A-monitoring-guidelines">ðŸ“Š Monitoring Guidelines</h2>
<h3 id="key-performance-indicators-kpis">Key Performance Indicators (KPIs)</h3>
<h4 id="system-metrics">System Metrics</h4>
<ul>
<li><strong>CPU Usage</strong>: &lt; 80% average</li>
<li><strong>Memory Usage</strong>: &lt; 85% of available</li>
<li><strong>Disk Usage</strong>: &lt; 90% of available</li>
<li><strong>Network I/O</strong>: Monitor for unusual spikes</li>
</ul>
<h4 id="application-metrics">Application Metrics</h4>
<ul>
<li><strong>Response Time</strong>: &lt; 2 seconds for 95th percentile</li>
<li><strong>Error Rate</strong>: &lt; 1% of total requests</li>
<li><strong>Throughput</strong>: Monitor requests per second</li>
<li><strong>Active Users</strong>: Track concurrent sessions</li>
</ul>
<h4 id="database-metrics">Database Metrics</h4>
<ul>
<li><strong>Connection Pool Usage</strong>: &lt; 80% of max connections</li>
<li><strong>Query Performance</strong>: &lt; 100ms for 95th percentile</li>
<li><strong>Lock Waits</strong>: Monitor for blocking queries</li>
<li><strong>Database Size Growth</strong>: Track growth rate</li>
</ul>
<h3 id="monitoring-setup">Monitoring Setup</h3>
<h4 id="prometheus-configuration">Prometheus Configuration</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># prometheus.yml</span>
<span class="hljs-attr">global:</span>
  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>

<span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'rag-interface'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> <span class="hljs-string">['localhost:8000',</span> <span class="hljs-string">'localhost:8001'</span><span class="hljs-string">,</span> <span class="hljs-string">'localhost:8002'</span><span class="hljs-string">,</span> <span class="hljs-string">'localhost:8003'</span><span class="hljs-string">,</span> <span class="hljs-string">'localhost:8004'</span><span class="hljs-string">]</span>
    <span class="hljs-attr">metrics_path:</span> <span class="hljs-string">/metrics</span>
    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">30s</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'postgres'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> <span class="hljs-string">['localhost:9187']</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'redis'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> <span class="hljs-string">['localhost:9121']</span>
</div></code></pre>
<h4 id="grafana-dashboard">Grafana Dashboard</h4>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"dashboard"</span>: {
    <span class="hljs-attr">"title"</span>: <span class="hljs-string">"RAG Interface System"</span>,
    <span class="hljs-attr">"panels"</span>: [
      {
        <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Service Health"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"stat"</span>,
        <span class="hljs-attr">"targets"</span>: [
          {
            <span class="hljs-attr">"expr"</span>: <span class="hljs-string">"up{job=\"rag-interface\"}"</span>,
            <span class="hljs-attr">"legendFormat"</span>: <span class="hljs-string">"{{instance}}"</span>
          }
        ]
      },
      {
        <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Response Time"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"graph"</span>,
        <span class="hljs-attr">"targets"</span>: [
          {
            <span class="hljs-attr">"expr"</span>: <span class="hljs-string">"histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))"</span>,
            <span class="hljs-attr">"legendFormat"</span>: <span class="hljs-string">"95th percentile"</span>
          }
        ]
      }
    ]
  }
}
</div></code></pre>
<h3 id="alerting-rules">Alerting Rules</h3>
<h4 id="critical-alerts">Critical Alerts</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># alerts.yml</span>
<span class="hljs-attr">groups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rag-interface</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">ServiceDown</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">up{job="rag-interface"}</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"Service <span class="hljs-template-variable">{{ $labels.instance }}</span> is down"</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighErrorRate</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">rate(http_requests_total{status=~"5.."}[5m])</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.1</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"High error rate on <span class="hljs-template-variable">{{ $labels.instance }}</span>"</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">DatabaseConnectionsHigh</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">pg_stat_database_numbackends</span> <span class="hljs-string">/</span> <span class="hljs-string">pg_settings_max_connections</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.8</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"Database connections high"</span>
</div></code></pre>
<h2 id="%F0%9F%9A%80-performance-optimization">ðŸš€ Performance Optimization</h2>
<h3 id="database-optimization">Database Optimization</h3>
<h4 id="index-optimization">Index Optimization</h4>
<pre class="hljs"><code><div><span class="hljs-comment">-- Check for missing indexes</span>
<span class="hljs-keyword">SELECT</span> schemaname, tablename, attname, n_distinct, correlation
<span class="hljs-keyword">FROM</span> pg_stats
<span class="hljs-keyword">WHERE</span> schemaname = <span class="hljs-string">'public'</span>
<span class="hljs-keyword">AND</span> n_distinct &gt; <span class="hljs-number">100</span>
<span class="hljs-keyword">AND</span> correlation &lt; <span class="hljs-number">0.1</span>;

<span class="hljs-comment">-- Create recommended indexes</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> CONCURRENTLY idx_error_reports_created_at_status 
<span class="hljs-keyword">ON</span> error_reports(created_at, <span class="hljs-keyword">status</span>) 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'pending'</span>, <span class="hljs-string">'in_progress'</span>);
</div></code></pre>
<h4 id="query-optimization">Query Optimization</h4>
<pre class="hljs"><code><div><span class="hljs-comment">-- Identify slow queries</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">query</span>, calls, total_exec_time, mean_exec_time
<span class="hljs-keyword">FROM</span> pg_stat_statements
<span class="hljs-keyword">WHERE</span> mean_exec_time &gt; <span class="hljs-number">1000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_exec_time <span class="hljs-keyword">DESC</span>
<span class="hljs-keyword">LIMIT</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- Optimize connection pooling</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> max_connections = <span class="hljs-number">200</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> shared_buffers = <span class="hljs-string">'256MB'</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> effective_cache_size = <span class="hljs-string">'1GB'</span>;
</div></code></pre>
<h3 id="application-optimization">Application Optimization</h3>
<h4 id="container-resource-limits">Container Resource Limits</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">error-reporting-service:</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">limits:</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'1.0'</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">512M</span>
        <span class="hljs-attr">reservations:</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'0.5'</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">256M</span>
</div></code></pre>
<h4 id="caching-strategy">Caching Strategy</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Redis caching configuration</span>
CACHE_CONFIG = {
    <span class="hljs-string">'default'</span>: {
        <span class="hljs-string">'BACKEND'</span>: <span class="hljs-string">'django_redis.cache.RedisCache'</span>,
        <span class="hljs-string">'LOCATION'</span>: <span class="hljs-string">'redis://redis:6379/1'</span>,
        <span class="hljs-string">'OPTIONS'</span>: {
            <span class="hljs-string">'CLIENT_CLASS'</span>: <span class="hljs-string">'django_redis.client.DefaultClient'</span>,
            <span class="hljs-string">'CONNECTION_POOL_KWARGS'</span>: {
                <span class="hljs-string">'max_connections'</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">'retry_on_timeout'</span>: <span class="hljs-literal">True</span>,
            }
        },
        <span class="hljs-string">'TIMEOUT'</span>: <span class="hljs-number">300</span>,  <span class="hljs-comment"># 5 minutes</span>
    }
}
</div></code></pre>
<h2 id="%F0%9F%94%92-security-maintenance">ðŸ”’ Security Maintenance</h2>
<h3 id="regular-security-tasks">Regular Security Tasks</h3>
<h4 id="certificate-management">Certificate Management</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># check_certificates.sh</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Certificate Status Check ==="</span>

<span class="hljs-comment"># Check SSL certificate expiration</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v openssl &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Checking SSL certificates..."</span>
    <span class="hljs-built_in">echo</span> | openssl s_client -servername localhost -connect localhost:443 2&gt;/dev/null | openssl x509 -noout -dates
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Check container image vulnerabilities</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Checking container vulnerabilities..."</span>
podman-compose images --format <span class="hljs-string">"{{.Repository}}:{{.Tag}}"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> image; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Scanning <span class="hljs-variable">$image</span>..."</span>
    podman image scan <span class="hljs-string">"<span class="hljs-variable">$image</span>"</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"Scan failed for <span class="hljs-variable">$image</span>"</span>
<span class="hljs-keyword">done</span>
</div></code></pre>
<h4 id="access-review">Access Review</h4>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># access_review.sh</span>

<span class="hljs-built_in">cd</span> /opt/rag-interface/deployment/podman

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Access Review - <span class="hljs-variable">$(date)</span> ==="</span>

<span class="hljs-comment"># List all users and their last login</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
SELECT username, roles, status, last_login_at,
       CASE 
           WHEN last_login_at IS NULL THEN 'Never logged in'
           WHEN last_login_at &lt; NOW() - INTERVAL '90 days' THEN 'Inactive (90+ days)'
           WHEN last_login_at &lt; NOW() - INTERVAL '30 days' THEN 'Inactive (30+ days)'
           ELSE 'Active'
       END as activity_status
FROM users
ORDER BY last_login_at DESC NULLS LAST;
"</span>

<span class="hljs-comment"># Check for admin users</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nAdmin users:"</span>
podman-compose <span class="hljs-built_in">exec</span> postgres psql -U postgres -d user_management_db -c <span class="hljs-string">"
SELECT username, created_at, last_login_at
FROM users
WHERE roles::text LIKE '%admin%';
"</span>
</div></code></pre>
<hr>
<p><strong>Document Version</strong>: 1.0<br>
<strong>Last Updated</strong>: 2025-01-20<br>
<strong>Next Review</strong>: 2025-04-20</p>

</body>
</html>
